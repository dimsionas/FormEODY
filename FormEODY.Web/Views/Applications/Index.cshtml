@{
    ViewData["Title"] = "Applications";
}

<h2>Applications</h2>

<div class="d-flex mb-3">
    <a asp-action="Create" class="btn btn-primary me-2">
        âž• New Application
    </a>
    <a asp-controller="Occupations" asp-action="Index" class="btn btn-outline-secondary">
        Manage Occupations
    </a>
</div>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}

<div id="applicationsGrid"></div>

@section Scripts {
    <script>
        $(function () {
            const store = DevExpress.data.AspNet.createStore({
                key: "id",
                loadUrl: "/Applications/Data"
            });

            $("#applicationsGrid").dxDataGrid({
                dataSource: store,
                remoteOperations: true,
                columnAutoWidth: true,
                rowAlternationEnabled: true,
                paging: { pageSize: 10 },
                pager: {
                    showPageSizeSelector: true,
                    allowedPageSizes: [10, 20, 50],
                    showInfo: true
                },
                filterRow: { visible: true },
                searchPanel: { visible: true },
                columns: [
                    { dataField: "name", caption: "Name" },
                    {
                        dataField: "gender",
                        caption: "Gender",
                        lookup: {
                            dataSource: [
                                { value: 0, text: "Male" },
                                { value: 1, text: "Female" }
                            ],
                            valueExpr: "value",
                            displayExpr: "text"
                        },
                        calculateDisplayValue: function (row) {
                            return row.gender === 0 || row.gender === "Male" ? "Male" : "Female";
                        }
                    },
                    {
                        dataField: "single",
                        caption: "Single",
                        dataType: "boolean"
                    },
                    { dataField: "occupation", caption: "Occupation" },
                    { dataField: "message", caption: "Message" },
                    {
                        caption: "Actions",
                        width: 180,
                        allowFiltering: false,
                        allowSorting: false,
                        cellTemplate: function (container, options) {
                            const id = options.data.id;
                            const view = $("<a>")
                                .attr("href", `/Applications/Details/${id}`)
                                .attr("title", "View")
                                .html('<i class="dx-icon-search"></i>');
                            const edit = $("<a>")
                                .attr("href", `/Applications/Edit/${id}`)
                                .attr("title", "Edit")
                                .html('<i class="dx-icon-edit"></i>');
                            const form = $("<form>")
                                .attr("method", "post")
                                .attr("action", "/Applications/Delete")
                                .css("display", "inline");
                            form.append($("<input>").attr("type", "hidden").attr("name", "id").val(id));
                            const delBtn = $("<button>")
                                .attr("type", "submit")
                                .addClass("btn btn-link p-0")
                                .attr("title", "Delete")
                                .css({ color: "red", "margin-left": "6px" })
                                .html('<i class="dx-icon-trash"></i>')
                                .on("click", function (e) {
                                    if (!confirm("Delete this application?")) {
                                        e.preventDefault();
                                    }
                                });
                            form.append(delBtn);

                            container.append(view).append(" | ").append(edit).append(" | ").append(form);
                        }
                    }
                ]
            });
        });
    </script>
}
